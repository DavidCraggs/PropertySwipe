# Seeding System Migration - Action Required

## Step 1: Run SQL Migration ‚úÖ (DO THIS FIRST)

**Open your Supabase SQL Editor and run this:**

```sql
-- Migration: Add seed_tag column to all tables for test data identification

-- Add seed_tag column to all tables that will contain seed data
ALTER TABLE renter_profiles ADD COLUMN IF NOT EXISTS seed_tag text;
ALTER TABLE landlord_profiles ADD COLUMN IF NOT EXISTS seed_tag text;
ALTER TABLE agency_profiles ADD COLUMN IF NOT EXISTS seed_tag text;
ALTER TABLE properties ADD COLUMN IF NOT EXISTS seed_tag text;
ALTER TABLE matches ADD COLUMN IF NOT EXISTS seed_tag text;
ALTER TABLE issues ADD COLUMN IF NOT EXISTS seed_tag text;
ALTER TABLE ratings ADD COLUMN IF NOT EXISTS seed_tag text;
ALTER TABLE agency_property_links ADD COLUMN IF NOT EXISTS seed_tag text;

-- Create indexes for faster seed data queries (optional but recommended)
CREATE INDEX IF NOT EXISTS idx_renter_profiles_seed_tag ON renter_profiles(seed_tag) WHERE seed_tag IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_landlord_profiles_seed_tag ON landlord_profiles(seed_tag) WHERE seed_tag IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_agency_profiles_seed_tag ON agency_profiles(seed_tag) WHERE seed_tag IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_properties_seed_tag ON properties(seed_tag) WHERE seed_tag IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_matches_seed_tag ON matches(seed_tag) WHERE seed_tag IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_issues_seed_tag ON issues(seed_tag) WHERE seed_tag IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_ratings_seed_tag ON ratings(seed_tag) WHERE seed_tag IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_agency_property_links_seed_tag ON agency_property_links(seed_tag) WHERE seed_tag IS NOT NULL;
```

## Step 2: Verify Migration

After running the SQL, verify it worked:

```sql
SELECT 
  table_name,
  column_name,
  data_type
FROM information_schema.columns
WHERE column_name = 'seed_tag'
  AND table_schema = 'public'
ORDER BY table_name;
```

You should see 8 rows (one for each table).

## Step 3: Code Updates (I'LL DO THIS)

Once you confirm the SQL ran successfully, I will:

1. ‚úÖ Update `seedHelpers.ts` - Already done (changed `_ID` to `_TAG`)
2. ‚è≥ Update `seedUserProfiles.ts` - Use `seed_tag`, let Supabase generate UUIDs
3. ‚è≥ Update `seedProperties.ts` - Use `seed_tag`, track generated IDs
4. ‚è≥ Update `seedMatches.ts` - Use generated IDs from previous steps
5. ‚è≥ Update `seedMessages.ts` - Use generated match IDs
6. ‚è≥ Update `seedViewingRequests.ts` - Use generated IDs
7. ‚è≥ Update `seedMaintenanceIssues.ts` - Use generated IDs
8. ‚è≥ Update `seedRatings.ts` - Use generated IDs
9. ‚è≥ Update `seedTestData.ts` - Use `seed_tag` for cleanup/verification

## Current Status

- ‚úÖ SQL migration file created: `supabase_add_seed_tag.sql`
- ‚úÖ Constants updated in `seedHelpers.ts`
- ‚è≥ Waiting for you to run SQL migration
- ‚è≥ Then I'll update all seeding files

## What This Fixes

**Before (Broken):**
```typescript
{
  id: 'seed-renter-001',  // ‚ùå Text string, not UUID
  email: '...',
}
```

**After (Working):**
```typescript
{
  // id is auto-generated by Supabase as UUID
  seed_tag: 'seed-renter-001',  // ‚úÖ For identification
  email: '...',
}
```

## Next Steps

1. **YOU:** Run the SQL in Supabase SQL Editor
2. **YOU:** Confirm it worked (run verification query)
3. **ME:** Update all seeding files to use `seed_tag`
4. **RESULT:** Seeding will work! üéâ

Let me know when you've run the SQL and I'll proceed with the code updates!
